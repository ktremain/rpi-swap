.TH SWAP.CONF 5 "rpi-swap" "rpi-swap Configuration"

.SH NAME
swap.conf, swap.conf.d \- Raspberry Pi swap management configuration files

.SH SYNOPSIS
/etc/rpi/swap.conf, /run/rpi/swap.conf, /usr/local/lib/rpi/swap.conf, /usr/lib/rpi/swap.conf, /etc/rpi/swap.conf.d/*.conf, /run/rpi/swap.conf.d/*.conf, /usr/local/lib/rpi/swap.conf.d/*.conf, /usr/lib/rpi/swap.conf.d/*.conf

.SH DESCRIPTION
These files configure various parameters of the Raspberry Pi swap management scripts. See systemd.syntax(7) for a general description of the syntax.

.SH CONFIGURATION DIRECTORIES AND PRECEDENCE
The default configuration is defined in the swap management scripts, so configuration is only needed when it is necessary to deviate from those defaults. The rpi-swap package ships with a main configuration file at /etc/rpi/swap.conf. In general, the main configuration file is loaded from one of the listed directories in order of priority, only the first file found is used: /etc/rpi/, /run/rpi/, /usr/local/lib/rpi/, /usr/lib/rpi/. The vendor version of the file contains commented out entries showing the defaults as a guide to the administrator.

Local overrides can be created by editing the main configuration file at /etc/rpi/swap.conf directly, or by creating drop-ins as described below. However, using drop-ins for local configuration is recommended over modifications to the main configuration file.

In addition to the main configuration file, drop-in configuration snippets are read from /usr/lib/rpi/swap.conf.d/*.conf, /usr/local/lib/rpi/swap.conf.d/*.conf, /run/rpi/swap.conf.d/*.conf, and /etc/rpi/swap.conf.d/*.conf. Those drop-ins have higher precedence and override the main configuration file. Files in the *.conf.d/ configuration subdirectories are sorted by their filename in lexicographic order, regardless of in which of the subdirectories they reside. When multiple files specify the same option, for options which accept just a single value, the entry in the file sorted last takes precedence.

Files in /etc/ are reserved for the local administrator, who may use this logic to override the configuration files installed by vendor packages. It is recommended to prefix all filenames in the *.conf.d/ subdirectories with a two-digit number and a dash, to simplify the ordering.

To disable a configuration file supplied by the vendor, the recommended way is to place a symlink to /dev/null in the configuration directory in /etc/, with the same filename as the vendor configuration file.

For a complete description of the configuration loading rules, see the 'CONFIGURATION DIRECTORIES AND PRECEDENCE' section of system.conf.d(5).

.SH OPTIONS
All options are configured in the [Main], [File], or [Zram] sections.

.SS "[Main] Section Options"

.TP
\fBMechanism=\fR
Controls which swap mechanism to use. One of "auto", "swapfile", "swapdev", "zram", "zram+file", "zram+device", and "none".
.RS
.IP \(bu 2
\fBauto\fR: Automatically selects the most appropriate mechanism. If a swap partition is detected (or \fBFile::Path\fR already points to a block device), auto prefers "zram+device" and uses that device for writeback. Otherwise it falls back to "zram+file". The creation of a swap partition is not automated; users must provision it themselves if they want auto to choose the device-backed path.
.IP \(bu 2
\fBswapfile\fR: A traditional swap file is created on the root filesystem.
.IP \(bu 2
\fBswapdev\fR: An existing block device (partition or disk) specified by \fBFile::Path\fR is activated directly as swap. No file resizing or creation occurs. Provisioning the swap partition is a manual step and is not performed by rpi-swap.
.IP \(bu 2
\fBzram\fR: A compressed RAM-based swap device is created. No swap file is used.
.IP \(bu 2
\fBzram+file\fR: A compressed RAM-based swap device is created, with the file specified in \fBFile::Path\fR used for writeback storage. The file is not used as a traditional swap device; instead, zram occasionally writes idle pages to it to free up RAM, reducing SD card wear through infrequent writes. Only the zram device will appear in \fBswapon -s\fR output; the backing file is not activated as swap.
.IP \(bu 2
\fBzram+device\fR: A compressed RAM-based swap device is created, with the block device specified in \fBFile::Path\fR used directly for writeback storage. No loop device or file is created; the device must already exist. Provisioning the swap partition is a manual step and is not performed by rpi-swap. Only the zram device will appear in \fBswapon -s\fR output; the backing device serves as writeback storage, not active swap.
.IP \(bu 2
\fBnone\fR: No swap is configured. Any existing swap file will be removed to free up disk space.
.RE
.IP
Defaults to "\fBauto\fR".

.SS "[File] Section Options"
These options configure the file or device used by swap-capable mechanisms. For "swapfile", the path serves as the primary swap file. For "swapdev", the path must be an existing block device that is activated directly as swap. For "zram+file", the path serves as writeback storage via a loop device. For "zram+device", the path must be an existing block device used directly for writeback. These options are disregarded for mechanisms that don't involve an external backing store (e.g. "zram"), and any existing file will be removed to free up disk space.

.TP
\fBPath=\fR
The path to the swap backing resource. For "swapfile", this is the swap file. For "swapdev", this must be the block device to activate as swap. For "zram+file", this is the writeback file (loop-mounted). For "zram+device", this must be the block device used for writeback. Defaults to "\fB/var/swap\fR".

.TP
\fBRamMultiplier=\fR
Target file size as a multiple of system RAM. For example, a value of "1" means a file size equal to the total system RAM, while "0.5" creates half the RAM size. The final swap size is constrained by \fBMaxSizeMiB\fR and \fBMaxDiskPercent\fR.

.TP
\fBMaxSizeMiB=\fR
The maximum file size in MiB (mebibytes). This limits the file size irrespective of the \fBRamMultiplier\fR setting. Set to an empty string to disable this limit. Defaults to "\fB2048\fR".

.TP
\fBMaxDiskPercent=\fR
The maximum percentage of available disk space to use for the file, to prevent it from consuming too much storage. Defaults to "\fB50\fR".

.TP
\fBFixedSizeMiB=\fR
A fixed file size in MiB (mebibytes). If set, this value overrides the \fBRamMultiplier\fR calculation and is used directly to set the exact file size.

.SS "[Zram] Section Options"
These options configure the zram (compressed RAM) swap device used by the "zram", "zram+file", and "zram+device" mechanisms.

When zram mechanisms are enabled, the system automatically optimises kernel parameters for compressed swap performance. This includes setting vm.page-cluster=0 to disable readahead, which reduces latency with minimal throughput impact on compressed RAM swap devices.

\fBNote:\fR With zram-based mechanisms, only the zram device (e.g., /dev/zram0) appears as active swap in \fBswapon -s\fR output. For "zram+file" and "zram+device" mechanisms, the backing file or device is used exclusively for writeback and will not appear as a separate swap device.

.TP
\fBRamMultiplier=\fR
Target zram decompressed capacity as a multiple of system RAM. For example, a value of "1" means a zram device capacity equal to the total system RAM, while "0.5" creates half the RAM size. Note that this represents the decompressed virtual capacity, not actual RAM usage. Due to compression, actual RAM consumption will be significantly lower (typically around 50% with 2x compression safely assumed). \fBWarning:\fR Values above 2.0 are not recommended, as poor compression could cause the zram device to consume all available RAM.

.TP
\fBMaxSizeMiB=\fR
The maximum zram decompressed capacity in MiB (mebibytes). This limits the zram size irrespective of the \fBRamMultiplier\fR setting. Set to an empty string to disable this limit. Like \fBRamMultiplier\fR, this represents decompressed virtual capacity.

.TP
\fBFixedSizeMiB=\fR
A fixed zram decompressed capacity in MiB (mebibytes). If set, this value overrides the \fBRamMultiplier\fR calculation and is used directly to set the exact zram virtual capacity.

The following options control writeback behaviour for the "zram+file" and "zram+device" mechanisms. Writeback allows zram to move idle pages to the writeback file or device, freeing up RAM while reducing flash wear through infrequent writes. These writeback options are ignored for other mechanisms.

\fBImportant:\fR The backing file or device is not activated as traditional swap and will not appear in \fBswapon -s\fR. To verify writeback is configured, check \fB/sys/block/zram0/backing_dev\fR, which should display the path to your writeback file or device.

.TP
\fBWritebackTrigger=\fR
Controls how zram writeback is triggered. One of "auto", "manual", and "timer".
.RS
.IP \(bu 2
\fBauto\fR: Automatically determines the most appropriate writeback strategy. At present, this defaults to "timer", but the default may change in future releases.
.IP \(bu 2
\fBmanual\fR: Prepares the system for writeback by marking pages as idle, but leaves writeback initiation to manual user intervention. Users can trigger writeback by writing to /sys/block/zram0/writeback as needed.
.IP \(bu 2
\fBtimer\fR: Uses a systemd timer to periodically trigger writeback operations at configured intervals.
.RE
.IP
Defaults to "\fBauto\fR".

.TP
\fBWritebackInitialDelay=\fR
The time to wait after system boot before performing the first writeback operation when using the "timer" trigger. This allows the system to settle and identifies pages that are genuinely less frequently accessed. Takes a time span value. See \fBsystemd.time\fR(7) for details on the syntax. This setting is ignored for other triggers. Defaults to "\fB180min\fR".

.TP
\fBWritebackPeriodicInterval=\fR
The interval between subsequent writeback operations when using the "timer" trigger. This determines how frequently zram will write back less active pages to the backing swap file. Takes a time span value. See \fBsystemd.time\fR(7) for details on the syntax. This setting is ignored for other triggers. Defaults to "\fB24h\fR".

.SH CONFIGURATION CHANGES
.B WARNING: After modifying any swap configuration, you must reboot the system for changes to take effect.

While running \fBsystemctl daemon-reload\fR after configuration changes will generate new swap units, existing swap units are not typically stopped by systemd, and new units will not be started automatically as they are pulled in by swap.target which has already been reached during boot.

The rpi-swap generator creates and sizes swap devices during early boot when memory pressure is minimal. Attempting to reconfigure swap after boot (such as resizing files whilst they are active) could lead to system instability, particularly on memory-constrained systems.

.B Always reboot after changing swap configuration to ensure the new settings are applied correctly and safely.

.SH MONITORING WRITEBACK TIMERS
When using the "timer" writeback initiator, you can monitor the timer status and next scheduled execution using systemctl:

.nf
systemctl list-timers rpi-zram-writeback.timer
.fi

This command shows when the timer last triggered, when it will next trigger, and how long until the next execution. The timer and service status can also be checked individually:

.nf
systemctl status rpi-zram-writeback.timer
systemctl status rpi-zram-writeback.service
.fi

.SH EXAMPLES
.SS "Example 1. Ensuring a traditional fixed-size swapfile is used"

To override the default swap mechanism and force the use of a traditional fixed-size (2 GB) swapfile, create the drop-in directory and configuration file:

.nf
sudo mkdir -p /etc/rpi/swap.conf.d/
sudo tee /etc/rpi/swap.conf.d/80-use-swapfile.conf > /dev/null <<EOF
[Main]
Mechanism=swapfile

[File]
FixedSizeMiB=2048
EOF
.fi

This drop-in configuration file will override the default "auto" mechanism and ensure that a traditional swapfile is always used instead of the default compressed RAM-based swap device.

.B After creating this configuration file, reboot the system for the changes to take effect.

.SS "Example 2. Disabling swap entirely"

To disable all swap functionality, create a drop-in configuration file:

.nf
sudo mkdir -p /etc/rpi/swap.conf.d/
sudo tee /etc/rpi/swap.conf.d/90-disable-swap.conf > /dev/null <<EOF
[Main]
Mechanism=none
EOF
.fi

This will disable all swap mechanisms and remove any existing swap file to free up disk space. This is useful for systems with abundant RAM where swap is not required.

.B After creating this configuration file, reboot the system for the changes to take effect.

.SS "Example 3. Using a swap partition"

To use an existing swap partition (for example, /dev/mmcblk0p3) instead of a file, create a drop-in configuration file:

.nf
sudo mkdir -p /etc/rpi/swap.conf.d/
sudo tee /etc/rpi/swap.conf.d/70-use-swapdev.conf > /dev/null <<EOF
[Main]
Mechanism=swapdev

[File]
Path=/dev/mmcblk0p3
EOF
.fi

This will activate the specified block device directly as swap. No file will be created or resized. Ensure the device exists at boot and contains no filesystem data you wish to keep.

.B After creating this configuration file, reboot the system for the changes to take effect.

.SS "Example 4. Using zram with a backing device"

To use zram with direct writeback to an existing block device (for example, /dev/mmcblk0p3) instead of a file-backed loop device, create a drop-in configuration file:

.nf
sudo mkdir -p /etc/rpi/swap.conf.d/
sudo tee /etc/rpi/swap.conf.d/75-use-zram-device.conf > /dev/null <<EOF
[Main]
Mechanism=zram+device

[File]
Path=/dev/mmcblk0p3
EOF
.fi

This configures a compressed zram swap device with writeback going directly to the specified block device. No file is created or resized. Ensure the device exists at boot and is safe to overwrite with swap data.

\fBNote:\fR Only /dev/zram0 will appear in \fBswapon -s\fR output. The backing device serves as writeback storage for idle pages and is not activated as traditional swap. To verify the configuration, run: \fBcat /sys/block/zram0/backing_dev\fR

.B After creating this configuration file, reboot the system for the changes to take effect.

.SH SEE ALSO
\fBsystemd.syntax\fR(7), \fBrpi-swap-generator\fR(8)

.SH NOTES
.IP "ðŸ’£ðŸ’¥ðŸ§¨ðŸ’¥ðŸ’¥ðŸ’£" 4
Please note that these configuration files must be available at all times. If /usr/local/ is a separate partition, it may not be available during early boot, and must not be used for configuration.
