.TH SWAP.CONF 5 "rpi-swap" "rpi-swap Configuration"

.SH NAME
swap.conf, swap.conf.d \- Raspberry Pi swap management configuration files

.SH SYNOPSIS
/etc/rpi/swap.conf, /run/rpi/swap.conf, /usr/local/lib/rpi/swap.conf, /usr/lib/rpi/swap.conf, /etc/rpi/swap.conf.d/*.conf, /run/rpi/swap.conf.d/*.conf, /usr/local/lib/rpi/swap.conf.d/*.conf, /usr/lib/rpi/swap.conf.d/*.conf

.SH DESCRIPTION
These files configure various parameters of the Raspberry Pi swap management scripts. See systemd.syntax(7) for a general description of the syntax.

.SH CONFIGURATION DIRECTORIES AND PRECEDENCE
The default configuration is defined in the swap management scripts, so configuration is only needed when it is necessary to deviate from those defaults. The rpi-swap package ships with a main configuration file at /etc/rpi/swap.conf. In general, the main configuration file is loaded from one of the listed directories in order of priority, only the first file found is used: /etc/rpi/, /run/rpi/, /usr/local/lib/rpi/, /usr/lib/rpi/. The vendor version of the file contains commented out entries showing the defaults as a guide to the administrator.

Local overrides can be created by editing the main configuration file at /etc/rpi/swap.conf directly, or by creating drop-ins as described below. However, using drop-ins for local configuration is recommended over modifications to the main configuration file.

In addition to the main configuration file, drop-in configuration snippets are read from /usr/lib/rpi/swap.conf.d/*.conf, /usr/local/lib/rpi/swap.conf.d/*.conf, /run/rpi/swap.conf.d/*.conf, and /etc/rpi/swap.conf.d/*.conf. Those drop-ins have higher precedence and override the main configuration file. Files in the *.conf.d/ configuration subdirectories are sorted by their filename in lexicographic order, regardless of in which of the subdirectories they reside. When multiple files specify the same option, for options which accept just a single value, the entry in the file sorted last takes precedence.

Files in /etc/ are reserved for the local administrator, who may use this logic to override the configuration files installed by vendor packages. It is recommended to prefix all filenames in the *.conf.d/ subdirectories with a two-digit number and a dash, to simplify the ordering.

To disable a configuration file supplied by the vendor, the recommended way is to place a symlink to /dev/null in the configuration directory in /etc/, with the same filename as the vendor configuration file.

For a complete description of the configuration loading rules, see the 'CONFIGURATION DIRECTORIES AND PRECEDENCE' section of system.conf.d(5).

.SH OPTIONS
All options are configured in the [Main], [File], or [Zram] sections.

.SS "[Main] Section Options"

.TP
\fBMechanism=\fR
Controls which swap mechanism to use. One of "auto", "swapfile", "zram", "zram+file", and "none".
.RS
.IP \(bu 2
\fBauto\fR: Automatically selects the most appropriate mechanism. At present, this defaults to "zram+file", but the default may change in future releases. If you require a specific mechanism to always be used, set it explicitly.
.IP \(bu 2
\fBswapfile\fR: A traditional swap file is created on the root filesystem.
.IP \(bu 2
\fBzram\fR: A compressed RAM-based swap device is created. No swap file is used.
.IP \(bu 2
\fBzram+file\fR: A compressed RAM-based swap device is created, with the file specified in \fBFile::Path\fR as a backing store.
.IP \(bu 2
\fBnone\fR: No swap is configured. Any existing swap file will be removed to free up disk space.
.RE
.IP
Defaults to "\fBauto\fR".

.SS "[File] Section Options"
These options configure the file used by both the "swapfile" and "zram+file" mechanisms. For "swapfile", the file serves as the primary swap device. For "zram+file", it serves as a backing store for the compressed RAM-based swap device via a loop device. These options are disregarded for mechanisms that don't involve a file (e.g. "zram"), and any existing file will be removed to free up disk space.

.TP
\fBPath=\fR
The path to the swap file. This is used directly by the "swapfile" mechanism, and as a backing store via a loop device for the "zram+file" mechanism. Defaults to "\fB/var/swap\fR".

.TP
\fBRamMultiplier=\fR
Target file size as a multiple of system RAM. For example, a value of "1" means a file size equal to the total system RAM, while "0.5" creates half the RAM size. The final swap size is constrained by \fBMaxSizeMiB\fR and \fBMaxDiskPercent\fR.

.TP
\fBMaxSizeMiB=\fR
The maximum file size in MiB (mebibytes). This limits the file size irrespective of the \fBRamMultiplier\fR setting. Set to an empty string to disable this limit. Defaults to "\fB2048\fR".

.TP
\fBMaxDiskPercent=\fR
The maximum percentage of available disk space to use for the file, to prevent it from consuming too much storage. Defaults to "\fB50\fR".

.TP
\fBFixedSizeMiB=\fR
A fixed file size in MiB (mebibytes). If set, this value overrides the \fBRamMultiplier\fR calculation and is used directly to set the exact file size.

.SS "[Zram] Section Options"
These options configure the zram (compressed RAM) swap device used by both the "zram" and "zram+file" mechanisms.

.TP
\fBRamMultiplier=\fR
Target zram decompressed capacity as a multiple of system RAM. For example, a value of "1" means a zram device capacity equal to the total system RAM, while "0.5" creates half the RAM size. Note that this represents the decompressed virtual capacity, not actual RAM usage. Due to compression, actual RAM consumption will be significantly lower (typically around 50% with 2x compression safely assumed).

.TP
\fBMaxSizeMiB=\fR
The maximum zram decompressed capacity in MiB (mebibytes). This limits the zram size irrespective of the \fBRamMultiplier\fR setting. Set to an empty string to disable this limit. Like \fBRamMultiplier\fR, this represents decompressed virtual capacity.

.TP
\fBFixedSizeMiB=\fR
A fixed zram decompressed capacity in MiB (mebibytes). If set, this value overrides the \fBRamMultiplier\fR calculation and is used directly to set the exact zram virtual capacity.

The following options control writeback behaviour for the "zram+file" mechanism. Writeback allows zram to move less frequently accessed pages to the backing file, improving memory efficiency. These writeback options are ignored for other mechanisms.

.TP
\fBWritebackTrigger=\fR
Controls how zram writeback is triggered. One of "auto", "manual", and "timer".
.RS
.IP \(bu 2
\fBauto\fR: Automatically determines the most appropriate writeback strategy. At present, this defaults to "timer", but the default may change in future releases.
.IP \(bu 2
\fBmanual\fR: Prepares the system for writeback by marking pages as idle, but leaves writeback initiation to manual user intervention. Users can trigger writeback by writing to /sys/block/zram0/writeback as needed.
.IP \(bu 2
\fBtimer\fR: Uses a systemd timer to periodically trigger writeback operations at configured intervals.
.RE
.IP
Defaults to "\fBauto\fR".

.TP
\fBWritebackInitialDelay=\fR
The time to wait after system boot before performing the first writeback operation when using the "timer" trigger. This allows the system to settle and identifies pages that are genuinely less frequently accessed. Takes a time span value. See \fBsystemd.time\fR(7) for details on the syntax. This setting is ignored for other triggers. Defaults to "\fB180min\fR".

.TP
\fBWritebackPeriodicInterval=\fR
The interval between subsequent writeback operations when using the "timer" trigger. This determines how frequently zram will write back less active pages to the backing swap file. Takes a time span value. See \fBsystemd.time\fR(7) for details on the syntax. This setting is ignored for other triggers. Defaults to "\fB24h\fR".

.SH MONITORING WRITEBACK TIMERS
When using the "timer" writeback initiator, you can monitor the timer status and next scheduled execution using systemctl:

.nf
systemctl list-timers rpi-zram-writeback.timer
.fi

This command shows when the timer last triggered, when it will next trigger, and how long until the next execution. The timer and service status can also be checked individually:

.nf
systemctl status rpi-zram-writeback.timer
systemctl status rpi-zram-writeback.service
.fi

.SH EXAMPLES
.SS "Example 1. Ensuring a traditional swapfile is used"

To override the default swap mechanism and force the use of a traditional swapfile, create the drop-in directory and configuration file:

.nf
sudo mkdir -p /etc/rpi/swap.conf.d/
sudo tee /etc/rpi/swap.conf.d/80-use-swapfile.conf > /dev/null <<EOF
[Main]
Mechanism=swapfile
EOF
.fi

This drop-in configuration file will override the default "auto" mechanism and ensure that a traditional swapfile is always used instead of the default compressed RAM-based swap device.

.SS "Example 2. Disabling swap entirely"

To disable all swap functionality, create a drop-in configuration file:

.nf
sudo mkdir -p /etc/rpi/swap.conf.d/
sudo tee /etc/rpi/swap.conf.d/90-disable-swap.conf > /dev/null <<EOF
[Main]
Mechanism=none
EOF
.fi

This will disable all swap mechanisms and remove any existing swap file to free up disk space. This is useful for systems with abundant RAM where swap is not required.

.SH SEE ALSO
\fBsystemd.syntax\fR(7), \fBrpi-swap-generator\fR(8)

.SH NOTES
.IP "ðŸ’£ðŸ’¥ðŸ§¨ðŸ’¥ðŸ’¥ðŸ’£" 4
Please note that these configuration files must be available at all times. If /usr/local/ is a separate partition, it may not be available during early boot, and must not be used for configuration.
